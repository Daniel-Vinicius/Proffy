{"version":3,"sources":["../sources/accessible-name-and-description.ts"],"names":["asFlatString","s","trim","replace","isHidden","node","getComputedStyleImplementation","hasAttribute","getAttribute","style","getPropertyValue","isControl","hasAbstractRole","role","TypeError","querySelectorAllSubtree","element","selectors","elements","querySelectorAll","forEach","root","push","apply","querySelectedOptions","listbox","selectedOptions","isMarkedPresentational","isNativeHostLanguageTextAlternativeElement","allowsNameFromContent","isDescendantOfNativeHostLanguageTextAlternativeElement","computeTooltipAttributeValue","getValueOfTextbox","value","textContent","getTextualContent","declaration","content","test","slice","isLabelableElement","tagName","findLabelableElement","labelableElement","childNodes","childNode","descendantLabelableElement","getControlOfLabel","label","control","undefined","htmlFor","ownerDocument","getElementById","getLabels","labelsProperty","labels","document","filter","computeTextAlternative","options","consultedNodes","SetLike","window","compute","getComputedStyle","bind","computeMiscTextAlternative","context","accumulatedText","pseudoBefore","beforeContent","concat","child","result","isEmbeddedInLabel","isReferenced","recursion","display","separator","pseudoAfter","afterContent","computeAttributeTextAlternative","titleAttribute","getAttributeNode","has","add","altAttribute","type","computeElementTextAlternative","children","i","length","input","map","join","current","labelElements","skipToStep2E","ariaLabel","elementTextAlternative","attributeTextAlternative","selectedOption","nodeType","TEXT_NODE","tooltipAttributeValue"],"mappings":"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","sourcesContent":["/**\n * implements https://w3c.github.io/accname/\n */\nimport ArrayFrom from \"./polyfills/array.from\";\nimport SetLike from \"./polyfills/SetLike\";\nimport {\n\thasAnyConcreteRoles,\n\tisElement,\n\tisHTMLTableCaptionElement,\n\tisHTMLInputElement,\n\tisHTMLSelectElement,\n\tisHTMLTextAreaElement,\n\tsafeWindow,\n\tisHTMLFieldSetElement,\n\tisHTMLLegendElement,\n\tisHTMLTableElement,\n\tisSVGSVGElement,\n\tisSVGTitleElement,\n\tqueryIdRefs,\n} from \"./util\";\n\n/**\n *  A string of characters where all carriage returns, newlines, tabs, and form-feeds are replaced with a single space, and multiple spaces are reduced to a single space. The string contains only character data; it does not contain any markup.\n */\ntype FlatString = string & {\n\t__flat: true;\n};\n\n/**\n * interface for an options-bag where `window.getComputedStyle` can be mocked\n */\nexport interface ComputeTextAlternativeOptions {\n\tcompute?: \"description\" | \"name\";\n\tgetComputedStyle?: typeof window.getComputedStyle;\n}\n\n/**\n *\n * @param {string} string -\n * @returns {FlatString} -\n */\nfunction asFlatString(s: string): FlatString {\n\treturn s.trim().replace(/\\s\\s+/g, \" \") as FlatString;\n}\n\n/**\n *\n * @param node -\n * @param options - These are not optional to prevent accidentally calling it without options in `computeAccessibleName`\n * @returns {boolean} -\n */\nfunction isHidden(\n\tnode: Node,\n\tgetComputedStyleImplementation: typeof window.getComputedStyle\n): node is Element {\n\tif (!isElement(node)) {\n\t\treturn false;\n\t}\n\n\tif (\n\t\tnode.hasAttribute(\"hidden\") ||\n\t\tnode.getAttribute(\"aria-hidden\") === \"true\"\n\t) {\n\t\treturn true;\n\t}\n\n\tconst style = getComputedStyleImplementation(node);\n\treturn (\n\t\tstyle.getPropertyValue(\"display\") === \"none\" ||\n\t\tstyle.getPropertyValue(\"visibility\") === \"hidden\"\n\t);\n}\n\n/**\n * @param {Node} node -\n * @returns {boolean} - As defined in step 2E of https://w3c.github.io/accname/#mapping_additional_nd_te\n */\nfunction isControl(node: Node): boolean {\n\treturn (\n\t\thasAnyConcreteRoles(node, [\"button\", \"combobox\", \"listbox\", \"textbox\"]) ||\n\t\thasAbstractRole(node, \"range\")\n\t);\n}\n\nfunction hasAbstractRole(node: Node, role: string): node is Element {\n\tif (!isElement(node)) {\n\t\treturn false;\n\t}\n\n\tswitch (role) {\n\t\tcase \"range\":\n\t\t\treturn hasAnyConcreteRoles(node, [\n\t\t\t\t\"meter\",\n\t\t\t\t\"progressbar\",\n\t\t\t\t\"scrollbar\",\n\t\t\t\t\"slider\",\n\t\t\t\t\"spinbutton\",\n\t\t\t]);\n\t\tdefault:\n\t\t\tthrow new TypeError(\n\t\t\t\t`No knowledge about abstract role '${role}'. This is likely a bug :(`\n\t\t\t);\n\t}\n}\n\n/**\n * element.querySelectorAll but also considers owned tree\n * @param element\n * @param selectors\n */\nfunction querySelectorAllSubtree(\n\telement: Element,\n\tselectors: string\n): Element[] {\n\tconst elements = ArrayFrom(element.querySelectorAll(selectors));\n\n\tqueryIdRefs(element, \"aria-owns\").forEach((root) => {\n\t\t// babel transpiles this assuming an iterator\n\t\telements.push.apply(elements, ArrayFrom(root.querySelectorAll(selectors)));\n\t});\n\n\treturn elements;\n}\n\nfunction querySelectedOptions(listbox: Element): ArrayLike<Element> {\n\tif (isHTMLSelectElement(listbox)) {\n\t\t// IE11 polyfill\n\t\treturn (\n\t\t\tlistbox.selectedOptions || querySelectorAllSubtree(listbox, \"[selected]\")\n\t\t);\n\t}\n\treturn querySelectorAllSubtree(listbox, '[aria-selected=\"true\"]');\n}\n\nfunction isMarkedPresentational(node: Node): node is Element {\n\treturn hasAnyConcreteRoles(node, [\"none\", \"presentation\"]);\n}\n\n/**\n * Elements specifically listed in html-aam\n *\n * We don't need this for `label` or `legend` elements.\n * Their implicit roles already allow \"naming from content\".\n *\n * sources:\n *\n * - https://w3c.github.io/html-aam/#table-element\n */\nfunction isNativeHostLanguageTextAlternativeElement(\n\tnode: Node\n): node is Element {\n\treturn isHTMLTableCaptionElement(node);\n}\n\n/**\n * https://w3c.github.io/aria/#namefromcontent\n */\nfunction allowsNameFromContent(node: Node): boolean {\n\treturn hasAnyConcreteRoles(node, [\n\t\t\"button\",\n\t\t\"cell\",\n\t\t\"checkbox\",\n\t\t\"columnheader\",\n\t\t\"gridcell\",\n\t\t\"heading\",\n\t\t\"label\",\n\t\t\"legend\",\n\t\t\"link\",\n\t\t\"menuitem\",\n\t\t\"menuitemcheckbox\",\n\t\t\"menuitemradio\",\n\t\t\"option\",\n\t\t\"radio\",\n\t\t\"row\",\n\t\t\"rowheader\",\n\t\t\"switch\",\n\t\t\"tab\",\n\t\t\"tooltip\",\n\t\t\"treeitem\",\n\t]);\n}\n\n/**\n * TODO https://github.com/eps1lon/dom-accessibility-api/issues/100\n */\nfunction isDescendantOfNativeHostLanguageTextAlternativeElement(\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars -- not implemented yet\n\tnode: Node\n): boolean {\n\treturn false;\n}\n\n/**\n * TODO https://github.com/eps1lon/dom-accessibility-api/issues/101\n */\n// eslint-disable-next-line @typescript-eslint/no-unused-vars -- not implemented yet\nfunction computeTooltipAttributeValue(node: Node): string | null {\n\treturn null;\n}\n\nfunction getValueOfTextbox(element: Element): string {\n\tif (isHTMLInputElement(element) || isHTMLTextAreaElement(element)) {\n\t\treturn element.value;\n\t}\n\t// https://github.com/eps1lon/dom-accessibility-api/issues/4\n\treturn element.textContent || \"\";\n}\n\nfunction getTextualContent(declaration: CSSStyleDeclaration): string {\n\tconst content = declaration.getPropertyValue(\"content\");\n\tif (/^[\"'].*[\"']$/.test(content)) {\n\t\treturn content.slice(1, -1);\n\t}\n\treturn \"\";\n}\n\n/**\n * https://html.spec.whatwg.org/multipage/forms.html#category-label\n * TODO: form-associated custom elements\n * @param element\n */\nfunction isLabelableElement(element: Element): boolean {\n\tconst tagName = element.tagName;\n\n\treturn (\n\t\ttagName === \"BUTTON\" ||\n\t\t(tagName === \"INPUT\" && element.getAttribute(\"type\") !== \"hidden\") ||\n\t\ttagName === \"METER\" ||\n\t\ttagName === \"OUTPUT\" ||\n\t\ttagName === \"PROGRESS\" ||\n\t\ttagName === \"SELECT\" ||\n\t\ttagName === \"TEXTAREA\"\n\t);\n}\n\n/**\n * > [...], then the first such descendant in tree order is the label element's labeled control.\n * -- https://html.spec.whatwg.org/multipage/forms.html#labeled-control\n * @param element\n */\nfunction findLabelableElement(element: Element): Element | null {\n\tif (isLabelableElement(element)) {\n\t\treturn element;\n\t}\n\tlet labelableElement: Element | null = null;\n\telement.childNodes.forEach((childNode) => {\n\t\tif (labelableElement === null && isElement(childNode)) {\n\t\t\tconst descendantLabelableElement = findLabelableElement(childNode);\n\t\t\tif (descendantLabelableElement !== null) {\n\t\t\t\tlabelableElement = descendantLabelableElement;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn labelableElement;\n}\n\n/**\n * Polyfill of HTMLLabelElement.control\n * https://html.spec.whatwg.org/multipage/forms.html#labeled-control\n * @param label\n */\nfunction getControlOfLabel(label: HTMLLabelElement): Element | null {\n\tif (label.control !== undefined) {\n\t\treturn label.control;\n\t}\n\n\tconst htmlFor = label.getAttribute(\"for\");\n\tif (htmlFor !== null) {\n\t\treturn label.ownerDocument.getElementById(htmlFor);\n\t}\n\n\treturn findLabelableElement(label);\n}\n\n/**\n * Polyfill of HTMLInputElement.labels\n * https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/labels\n * @param element\n */\nfunction getLabels(element: Element): HTMLLabelElement[] | null {\n\tconst labelsProperty = (element as any).labels as\n\t\t| undefined\n\t\t| null\n\t\t| NodeListOf<HTMLLabelElement>;\n\tif (labelsProperty === null) {\n\t\treturn labelsProperty;\n\t}\n\tif (labelsProperty !== undefined) {\n\t\treturn ArrayFrom(labelsProperty);\n\t}\n\n\tif (!isLabelableElement(element)) {\n\t\treturn null;\n\t}\n\tconst document = element.ownerDocument;\n\n\treturn ArrayFrom(document.querySelectorAll(\"label\")).filter((label) => {\n\t\treturn getControlOfLabel(label) === element;\n\t});\n}\n\n/**\n * implements https://w3c.github.io/accname/#mapping_additional_nd_te\n * @param root\n * @param [options]\n * @parma [options.getComputedStyle] - mock window.getComputedStyle. Needs `content`, `display` and `visibility`\n */\nexport function computeTextAlternative(\n\troot: Element,\n\toptions: ComputeTextAlternativeOptions = {}\n): string {\n\tconst consultedNodes = new SetLike<Node>();\n\n\tconst window = safeWindow(root);\n\tconst {\n\t\tcompute = \"name\",\n\t\t// This might be overengineered. I don't know what happens if I call\n\t\t// window.getComputedStyle(elementFromAnotherWindow) or if I don't bind it\n\t\t// the type declarations don't require a `this`\n\t\t// eslint-disable-next-line no-restricted-properties\n\t\tgetComputedStyle = window.getComputedStyle.bind(window),\n\t} = options;\n\n\t// 2F.i\n\tfunction computeMiscTextAlternative(\n\t\tnode: Node,\n\t\tcontext: { isEmbeddedInLabel: boolean; isReferenced: boolean }\n\t): string {\n\t\tlet accumulatedText = \"\";\n\t\tif (isElement(node)) {\n\t\t\tconst pseudoBefore = getComputedStyle(node, \"::before\");\n\t\t\tconst beforeContent = getTextualContent(pseudoBefore);\n\t\t\taccumulatedText = `${beforeContent} ${accumulatedText}`;\n\t\t}\n\n\t\t// FIXME: This is not defined in the spec\n\t\t// But it is required in the web-platform-test\n\t\tconst childNodes = ArrayFrom(node.childNodes).concat(\n\t\t\tqueryIdRefs(node, \"aria-owns\")\n\t\t);\n\t\tchildNodes.forEach((child) => {\n\t\t\tconst result = computeTextAlternative(child, {\n\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\tisReferenced: false,\n\t\t\t\trecursion: true,\n\t\t\t});\n\t\t\t// TODO: Unclear why display affects delimiter\n\t\t\t// see https://github.com/w3c/accname/issues/3\n\t\t\tconst display = isElement(child)\n\t\t\t\t? getComputedStyle(child).getPropertyValue(\"display\")\n\t\t\t\t: \"inline\";\n\t\t\tconst separator = display !== \"inline\" ? \" \" : \"\";\n\t\t\t// trailing separator for wpt tests\n\t\t\taccumulatedText += `${separator}${result}${separator}`;\n\t\t});\n\n\t\tif (isElement(node)) {\n\t\t\tconst pseudoAfter = getComputedStyle(node, \":after\");\n\t\t\tconst afterContent = getTextualContent(pseudoAfter);\n\t\t\taccumulatedText = `${accumulatedText} ${afterContent}`;\n\t\t}\n\n\t\treturn accumulatedText;\n\t}\n\n\tfunction computeAttributeTextAlternative(node: Node): string | null {\n\t\tif (!isElement(node)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst titleAttribute = node.getAttributeNode(\"title\");\n\t\tif (titleAttribute !== null && !consultedNodes.has(titleAttribute)) {\n\t\t\tconsultedNodes.add(titleAttribute);\n\t\t\treturn titleAttribute.value;\n\t\t}\n\n\t\tconst altAttribute = node.getAttributeNode(\"alt\");\n\t\tif (altAttribute !== null && !consultedNodes.has(altAttribute)) {\n\t\t\tconsultedNodes.add(altAttribute);\n\t\t\treturn altAttribute.value;\n\t\t}\n\n\t\tif (isHTMLInputElement(node) && node.type === \"button\") {\n\t\t\tconsultedNodes.add(node);\n\t\t\treturn node.getAttribute(\"value\") || \"\";\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction computeElementTextAlternative(node: Node): string | null {\n\t\t// https://w3c.github.io/html-aam/#fieldset-and-legend-elements\n\t\tif (isHTMLFieldSetElement(node)) {\n\t\t\tconsultedNodes.add(node);\n\t\t\tconst children = ArrayFrom(node.childNodes);\n\t\t\tfor (let i = 0; i < children.length; i += 1) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (isHTMLLegendElement(child)) {\n\t\t\t\t\treturn computeTextAlternative(child, {\n\t\t\t\t\t\tisEmbeddedInLabel: false,\n\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\trecursion: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\t// https://w3c.github.io/html-aam/#table-element\n\t\tif (isHTMLTableElement(node)) {\n\t\t\tconsultedNodes.add(node);\n\t\t\tconst children = ArrayFrom(node.childNodes);\n\t\t\tfor (let i = 0; i < children.length; i += 1) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (isHTMLTableCaptionElement(child)) {\n\t\t\t\t\treturn computeTextAlternative(child, {\n\t\t\t\t\t\tisEmbeddedInLabel: false,\n\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\trecursion: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\t// https://www.w3.org/TR/svg-aam-1.0/\n\t\tif (isSVGSVGElement(node)) {\n\t\t\tconsultedNodes.add(node);\n\t\t\tconst children = ArrayFrom(node.childNodes);\n\t\t\tfor (let i = 0; i < children.length; i += 1) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (isSVGTitleElement(child)) {\n\t\t\t\t\treturn child.textContent;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tif (\n\t\t\t!(\n\t\t\t\tisHTMLInputElement(node) ||\n\t\t\t\tisHTMLSelectElement(node) ||\n\t\t\t\tisHTMLTextAreaElement(node)\n\t\t\t)\n\t\t) {\n\t\t\treturn null;\n\t\t}\n\t\tconst input = node;\n\n\t\t// https://w3c.github.io/html-aam/#input-type-text-input-type-password-input-type-search-input-type-tel-input-type-email-input-type-url-and-textarea-element-accessible-description-computation\n\t\tif (input.type === \"submit\") {\n\t\t\treturn \"Submit\";\n\t\t}\n\t\tif (input.type === \"reset\") {\n\t\t\treturn \"Reset\";\n\t\t}\n\n\t\tconst labels = getLabels(input);\n\t\tif (labels === null || labels.length === 0) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconsultedNodes.add(input);\n\t\treturn ArrayFrom(labels)\n\t\t\t.map((element) => {\n\t\t\t\treturn computeTextAlternative(element, {\n\t\t\t\t\tisEmbeddedInLabel: true,\n\t\t\t\t\tisReferenced: false,\n\t\t\t\t\trecursion: true,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.filter((label) => {\n\t\t\t\treturn label.length > 0;\n\t\t\t})\n\t\t\t.join(\" \");\n\t}\n\n\tfunction computeTextAlternative(\n\t\tcurrent: Node,\n\t\tcontext: {\n\t\t\tisEmbeddedInLabel: boolean;\n\t\t\tisReferenced: boolean;\n\t\t\trecursion: boolean;\n\t\t}\n\t): string {\n\t\tif (consultedNodes.has(current)) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\t// special casing, cheating to make tests pass\n\t\t// https://github.com/w3c/accname/issues/67\n\t\tif (hasAnyConcreteRoles(current, [\"menu\"])) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn \"\";\n\t\t}\n\n\t\t// 2A\n\t\tif (isHidden(current, getComputedStyle) && !context.isReferenced) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn \"\" as FlatString;\n\t\t}\n\n\t\t// 2B\n\t\tconst labelElements = queryIdRefs(current, \"aria-labelledby\");\n\t\tif (\n\t\t\tcompute === \"name\" &&\n\t\t\t!context.isReferenced &&\n\t\t\tlabelElements.length > 0\n\t\t) {\n\t\t\treturn labelElements\n\t\t\t\t.map((element) =>\n\t\t\t\t\tcomputeTextAlternative(element, {\n\t\t\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\t\t\tisReferenced: true,\n\t\t\t\t\t\t// thais isn't recursion as specified, otherwise we would skip\n\t\t\t\t\t\t// `aria-label` in\n\t\t\t\t\t\t// <input id=\"myself\" aria-label=\"foo\" aria-labelledby=\"myself\"\n\t\t\t\t\t\trecursion: false,\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t\t.join(\" \");\n\t\t}\n\n\t\t// 2C\n\t\t// Changed from the spec in anticipation of https://github.com/w3c/accname/issues/64\n\t\t// spec says we should only consider skipping if we have a non-empty label\n\t\tconst skipToStep2E =\n\t\t\tcontext.recursion && isControl(current) && compute === \"name\";\n\t\tif (!skipToStep2E) {\n\t\t\tconst ariaLabel = (\n\t\t\t\t(isElement(current) && current.getAttribute(\"aria-label\")) ||\n\t\t\t\t\"\"\n\t\t\t).trim();\n\t\t\tif (ariaLabel !== \"\" && compute === \"name\") {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\treturn ariaLabel;\n\t\t\t}\n\n\t\t\t// 2D\n\t\t\tif (!isMarkedPresentational(current)) {\n\t\t\t\tconst elementTextAlternative = computeElementTextAlternative(current);\n\t\t\t\tif (elementTextAlternative !== null) {\n\t\t\t\t\tconsultedNodes.add(current);\n\t\t\t\t\treturn elementTextAlternative;\n\t\t\t\t}\n\t\t\t\tconst attributeTextAlternative = computeAttributeTextAlternative(\n\t\t\t\t\tcurrent\n\t\t\t\t);\n\t\t\t\tif (attributeTextAlternative !== null) {\n\t\t\t\t\tconsultedNodes.add(current);\n\t\t\t\t\treturn attributeTextAlternative;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// 2E\n\t\tif (skipToStep2E || context.isEmbeddedInLabel || context.isReferenced) {\n\t\t\tif (hasAnyConcreteRoles(current, [\"combobox\", \"listbox\"])) {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\tconst selectedOptions = querySelectedOptions(current);\n\t\t\t\tif (selectedOptions.length === 0) {\n\t\t\t\t\t// defined per test `name_heading_combobox`\n\t\t\t\t\treturn isHTMLInputElement(current) ? current.value : \"\";\n\t\t\t\t}\n\t\t\t\treturn ArrayFrom(selectedOptions)\n\t\t\t\t\t.map((selectedOption) => {\n\t\t\t\t\t\treturn computeTextAlternative(selectedOption, {\n\t\t\t\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\t\trecursion: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.join(\" \");\n\t\t\t}\n\t\t\tif (hasAbstractRole(current, \"range\")) {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\tif (current.hasAttribute(\"aria-valuetext\")) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- safe due to hasAttribute guard\n\t\t\t\t\treturn current.getAttribute(\"aria-valuetext\")!;\n\t\t\t\t}\n\t\t\t\tif (current.hasAttribute(\"aria-valuenow\")) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- safe due to hasAttribute guard\n\t\t\t\t\treturn current.getAttribute(\"aria-valuenow\")!;\n\t\t\t\t}\n\t\t\t\t// Otherwise, use the value as specified by a host language attribute.\n\t\t\t\treturn current.getAttribute(\"value\") || \"\";\n\t\t\t}\n\t\t\tif (hasAnyConcreteRoles(current, [\"textbox\"])) {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\treturn getValueOfTextbox(current);\n\t\t\t}\n\t\t}\n\n\t\t// 2F: https://w3c.github.io/accname/#step2F\n\t\tif (\n\t\t\tallowsNameFromContent(current) ||\n\t\t\t(isElement(current) && context.isReferenced) ||\n\t\t\tisNativeHostLanguageTextAlternativeElement(current) ||\n\t\t\tisDescendantOfNativeHostLanguageTextAlternativeElement(current)\n\t\t) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn computeMiscTextAlternative(current, {\n\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\tisReferenced: false,\n\t\t\t});\n\t\t}\n\n\t\tif (current.nodeType === current.TEXT_NODE) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn current.textContent || \"\";\n\t\t}\n\n\t\tif (context.recursion) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn computeMiscTextAlternative(current, {\n\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\tisReferenced: false,\n\t\t\t});\n\t\t}\n\n\t\tconst tooltipAttributeValue = computeTooltipAttributeValue(current);\n\t\tif (tooltipAttributeValue !== null) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn tooltipAttributeValue;\n\t\t}\n\n\t\t// TODO should this be reachable?\n\t\tconsultedNodes.add(current);\n\t\treturn \"\";\n\t}\n\n\treturn asFlatString(\n\t\tcomputeTextAlternative(root, {\n\t\t\tisEmbeddedInLabel: false,\n\t\t\t// by spec computeAccessibleDescription starts with the referenced elements as roots\n\t\t\tisReferenced: compute === \"description\",\n\t\t\trecursion: false,\n\t\t})\n\t);\n}\n"],"file":"accessible-name-and-description.js"}